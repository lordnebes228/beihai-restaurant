<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–ò–¢–í–ê –î–ê–ù–ù–´–•: PRO EDITION</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Exo+2:wght@400;900&display=swap');

        :root {
            --neon-blue: #00f2ff;
            --neon-pink: #ff00ff;
            --neon-green: #00ff9d;
            --bg-dark: #020617;
        }

        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Exo 2', sans-serif;
            margin: 0; padding: 20px; overflow-x: hidden;
            background-image: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%);
        }

        .main-ui { max-width: 1600px; margin: 0 auto; }

        header h1 {
            font-family: 'Orbitron', sans-serif; text-align: center;
            font-size: 5rem; margin: 20px 0;
            background: linear-gradient(to right, var(--neon-blue), var(--neon-pink));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .cockpit {
            background: rgba(15, 23, 42, 0.95); border: 4px solid var(--neon-blue);
            border-radius: 30px; padding: 30px; display: grid;
            grid-template-columns: repeat(3, 1fr) auto; gap: 20px;
            margin-bottom: 40px; align-items: flex-end;
        }

        .control-slot { display: flex; flex-direction: column; gap: 10px; }
        .button-group { display: flex; gap: 10px; }
        
        label { color: var(--neon-blue); font-size: 1.2rem; font-family: 'Orbitron'; font-weight: 900; }

        select {
            background: #000; color: #fff; border: 3px solid #334155;
            padding: 15px; border-radius: 15px; font-size: 1.4rem; font-weight: bold;
        }

        .btn-launch { 
            height: 65px; padding: 0 30px; font-size: 1.2rem; background: var(--neon-blue); 
            color: #000; font-family: 'Orbitron'; font-weight: 900;
            border: none; border-radius: 15px; cursor: pointer; transition: 0.3s;
        }
        .btn-launch:hover { transform: translateY(-3px); box-shadow: 0 0 30px var(--neon-blue); }

        /* –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ */
        .lane {
            background: rgba(0,0,0,0.8); height: 160px; border-radius: 25px;
            position: relative; border: 3px solid #1e293b; margin-bottom: 20px;
            display: flex; align-items: center; overflow: hidden;
        }

        @keyframes shake {
            0% { transform: translateY(0) scaleX(-1); }
            25% { transform: translateY(-5px) scaleX(-1); }
            75% { transform: translateY(5px) scaleX(-1); }
            100% { transform: translateY(0) scaleX(-1); }
        }
        .shaking { animation: shake 0.1s infinite; }
        
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–∫–µ—Ç—ã (–±–µ–∑ –∏–Ω–≤–µ—Ä—Å–∏–∏ scaleX) */
        .rocket-fix { transform: scaleX(1) !important; animation: shake-rocket 0.1s infinite !important; }
        @keyframes shake-rocket {
            0% { transform: translateY(0); }
            25% { transform: translateY(-5px); }
            75% { transform: translateY(5px); }
            100% { transform: translateY(0); }
        }

        .truck-unit { position: absolute; left: 0; font-size: 110px; z-index: 10; transform: scaleX(-1); }

        .road-marks {
            position: absolute; width: 100%; height: 100%;
            background-image: linear-gradient(90deg, rgba(255,255,255,0.05) 4px, transparent 4px);
            background-size: 80px 100%;
        }
        .moving .road-marks { animation: travel 0.2s linear infinite; }
        @keyframes travel { from { background-position: 0; } to { background-position: -80px; } }

        /* HUD */
        .hud-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .hud-box {
            background: #000; border: 3px solid #1e293b; padding: 20px;
            border-radius: 20px; text-align: center;
        }
        .hud-val { display: block; font-size: 3rem; font-family: 'Orbitron'; color: var(--neon-green); }

        /* –ò—Å—Ç–æ—Ä–∏—è –∏ –û—Ç—á–µ—Ç */
        .stats-area { display: grid; grid-template-columns: 1fr 350px; gap: 30px; }
        .panel-box { background: rgba(15, 23, 42, 0.8); border: 2px solid #334155; border-radius: 25px; padding: 25px; }
        h3 { font-family: 'Orbitron'; color: var(--neon-pink); margin-top: 0; }
        
        .history-item { 
            padding: 10px; border-bottom: 1px solid #334155; font-size: 1.1rem; 
            display: flex; justify-content: space-between;
        }

        table { width: 100%; border-collapse: collapse; font-size: 1.2rem; }
        th, td { border: 1px solid #334155; padding: 12px; text-align: center; }
        th { background: #1e293b; color: var(--neon-blue); }
    </style>
</head>
<body>

<div class="main-ui">
    <header><h1>–ë–ò–¢–í–ê –î–ê–ù–ù–´–•</h1></header>

    <div class="cockpit">
        <div class="control-slot">
            <label>–û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö</label>
            <select id="cargo">
                <option value="50">–§–û–¢–û (50 –ú–ë)</option>
                <option value="500">–§–ò–õ–¨–ú (500 –ú–ë)</option>
                <option value="2000">–ò–ì–†–ê (2 –ì–ë)</option>
                <option value="10000">–ê–†–•–ò–í (10 –ì–ë)</option>
            </select>
        </div>
        <div class="control-slot">
            <label>–¢–∏–ø —Å–µ—Ç–∏</label>
            <select id="speed">
                <option value="10">üöú 3G (10 –ú–ë/—Å)</option>
                <option value="100" selected>üöö 4G (100 –ú–ë/—Å)</option>
                <option value="600">üèéÔ∏è 5G (600 –ú–ë/—Å)</option>
                <option value="2500">üöÄ –û–ü–¢–ò–ö–ê (2.5 –ì–ë/—Å)</option>
            </select>
        </div>
        <div class="control-slot">
            <label>–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å</label>
            <select id="quality">
                <option value="1">–ò–¥–µ–∞–ª—å–Ω–∞—è (100%)</option>
                <option value="0.5">–ü–æ–º–µ—Ö–∏ (50%)</option>
                <option value="0.1">–ö—Ä–∏—Ç–∏—á–Ω–∞—è (10%)</option>
            </select>
        </div>
        <div class="button-group">
            <button class="btn-launch" onclick="startTest(false)">–¢–ï–°–¢</button>
            <button class="btn-launch" style="background: var(--neon-pink); color: white;" onclick="startTest(true)">–ì–û–ù–ö–ê</button>
        </div>
    </div>

    <div id="track-zone"></div>

    <div class="hud-grid">
        <div class="hud-box"><span class="hud-val" id="hud-v">0</span><span style="color:#94a3b8">–ú–ë / –°–ï–ö</span></div>
        <div class="hud-box"><span class="hud-val" id="hud-t" style="color:var(--neon-blue)">0.0</span><span style="color:#94a3b8">–°–ï–ö–£–ù–î</span></div>
        <div class="hud-box"><span class="hud-val" id="hud-p" style="color:var(--neon-pink)">0%</span><span style="color:#94a3b8">–ü–†–û–ì–†–ï–°–°</span></div>
    </div>

    <div class="stats-area">
        <div class="panel-box" id="analysis-report" style="display:none;">
            <h3>üìä –°–†–ê–í–ù–ï–ù–ò–ï –°–ï–¢–ï–ô</h3>
            <table id="report-table">
                <thead><tr><th>–°–µ—Ç—å</th><th>–í—Ä–µ–º—è</th><th>–ú–ë/—Å</th><th>–ò—Ç–æ–≥</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="panel-box">
            <h3>üìú –ò–°–¢–û–†–ò–Ø</h3>
            <div id="history-list"></div>
        </div>
    </div>
</div>

<script>
    const zone = document.getElementById('track-zone');
    const report = document.getElementById('analysis-report');
    const historyList = document.getElementById('history-list');
    const icons = { '10': 'üöú', '100': 'üöö', '600': 'üèéÔ∏è', '2500': 'üöÄ' };
    let timers = [];
    let raceResults = [];
    let historyData = [];

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playFinishSfx() {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine'; osc.frequency.setValueAtTime(587.33, audioCtx.currentTime); // –†–µ
        osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.2); // –õ—è
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.5);
    }

    function startTest(isRace) {
        timers.forEach(clearInterval);
        zone.innerHTML = '';
        report.style.display = 'none';
        raceResults = [];
        
        const cargo = parseFloat(document.getElementById('cargo').value);
        const quality = parseFloat(document.getElementById('quality').value);

        if (isRace) {
            const opts = document.getElementById('speed').options;
            for(let i=0; i<opts.length; i++) {
                createTrack(i, opts[i].text, parseFloat(opts[i].value), cargo, quality, false, opts.length);
            }
        } else {
            const s = document.getElementById('speed');
            createTrack(0, s.options[s.selectedIndex].text, parseFloat(s.value), cargo, quality, true, 1);
        }
    }

    function createTrack(id, name, speed, cargo, quality, updateHud, totalTracks) {
        const lane = document.createElement('div');
        lane.className = 'lane';
        
        const isRocket = speed === 2500;
        const truckClass = isRocket ? 'truck-unit rocket-fix' : 'truck-unit';
        
        lane.innerHTML = `
            <div style="position:absolute; top:10px; left:25px; font-size:1.4rem; color:var(--neon-blue); z-index:5; font-weight:bold; font-family:'Orbitron'">${name}</div>
            <div class="road-marks"></div>
            <div class="${truckClass}" id="truck-${id}">${icons[speed]}</div>
        `;
        zone.appendChild(lane);
        
        const truck = document.getElementById(`truck-${id}`);
        if (quality <= 0.1) truck.classList.add('shaking');
        lane.classList.add('moving');
        
        let delivered = 0;
        const start = Date.now();
        const vReal = speed * quality;

        const t = setInterval(() => {
            delivered += vReal / 10;
            let p = Math.min((delivered / cargo) * 100, 100);
            truck.style.left = `calc(${p}% - 130px)`;

            if (updateHud) {
                document.getElementById('hud-v').innerText = Math.round(vReal * (0.95 + Math.random()*0.1));
                document.getElementById('hud-t').innerText = ((Date.now()-start)/1000).toFixed(1);
                document.getElementById('hud-p').innerText = Math.round(p) + '%';
            }

            if (p >= 100) {
                clearInterval(t);
                playFinishSfx();
                const timeTaken = ((Date.now()-start)/1000).toFixed(2);
                lane.classList.remove('moving');
                lane.style.borderColor = 'var(--neon-green)';
                
                raceResults.push({ name, time: parseFloat(timeTaken), speed: vReal });
                
                if (totalTracks === 1) addToHistory(name, timeTaken);
                if (raceResults.length === totalTracks && totalTracks > 1) showReport();
            }
        }, 100);
        timers.push(t);
    }

    function showReport() {
        report.style.display = 'block';
        const tbody = document.querySelector('#report-table tbody');
        tbody.innerHTML = '';
        raceResults.sort((a,b) => a.time - b.time);
        const fastest = raceResults[0];

        raceResults.forEach(res => {
            const ratio = (res.time / fastest.time).toFixed(1);
            const eff = res.time === fastest.time ? "üèÜ –õ–£–ß–®–ò–ô" : `–ú–µ–¥–ª–µ–Ω–Ω–µ–µ –≤ ${ratio} —Ä–∞–∑`;
            tbody.innerHTML += `<tr><td>${res.name}</td><td>${res.time}—Å</td><td>${Math.round(res.speed)}</td><td>${eff}</td></tr>`;
        });
        addToHistory("–ì–û–ù–ö–ê –¢–ï–•–ù–û–õ–û–ì–ò–ô", fastest.time + "—Å (–ü–æ–±–µ–¥–∏—Ç–µ–ª—å)");
    }

    function addToHistory(type, res) {
        historyData.unshift({ type, res, time: new Date().toLocaleTimeString() });
        if (historyData.length > 5) historyData.pop();
        historyList.innerHTML = historyData.map(h => `
            <div class="history-item">
                <small>${h.time}</small>
                <strong>${h.type}</strong>
                <span style="color:var(--neon-green)">${h.res}</span>
            </div>
        `).join('');
    }
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–ò–¢–í–ê –î–ê–ù–ù–´–•: FINAL ULTRA</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Exo+2:wght@400;900&display=swap');

        :root {
            --neon-blue: #00f2ff;
            --neon-pink: #ff00ff;
            --neon-green: #00ff9d;
            --bg-dark: #020617;
        }

        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Exo 2', sans-serif;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center; /* –¶–µ–Ω—Ç—Ä–æ–≤–∫–∞ –≤—Å–µ–≥–æ */
            background-image: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%);
        }

        .main-ui { width: 100%; max-width: 1400px; display: flex; flex-direction: column; align-items: center; }

        header h1 {
            font-family: 'Orbitron', sans-serif; font-size: 5rem; margin: 20px 0;
            background: linear-gradient(to right, var(--neon-blue), var(--neon-pink));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
        .edu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; width: 100%; margin-bottom: 40px; }
        .edu-card {
            background: rgba(15, 23, 42, 0.8); border: 3px solid var(--neon-blue);
            padding: 30px; border-radius: 25px; text-align: center;
        }
        .edu-card h3 { color: var(--neon-pink); font-size: 2rem; font-family: 'Orbitron'; margin-bottom: 15px; }
        .edu-card p { font-size: 1.5rem; line-height: 1.6; margin: 0; }

        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .cockpit {
            background: rgba(15, 23, 42, 0.95); border: 4px solid var(--neon-blue);
            border-radius: 30px; padding: 30px; width: 100%;
            display: flex; justify-content: center; align-items: flex-end; gap: 20px;
            margin-bottom: 40px; box-sizing: border-box;
        }

        .control-slot { display: flex; flex-direction: column; gap: 10px; }
        label { color: var(--neon-blue); font-size: 1.1rem; font-family: 'Orbitron'; font-weight: 900; }

        select {
            background: #000; color: #fff; border: 3px solid #334155;
            padding: 15px; border-radius: 15px; font-size: 1.3rem; font-weight: bold;
        }

        .btn-launch { 
            height: 65px; padding: 0 40px; font-size: 1.2rem; background: var(--neon-blue); 
            color: #000; font-family: 'Orbitron'; font-weight: 900;
            border: none; border-radius: 15px; cursor: pointer; transition: 0.3s;
        }
        .btn-launch:hover { transform: scale(1.05); box-shadow: 0 0 30px var(--neon-blue); }

        /* –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ */
        .track-zone { width: 100%; }
        .lane {
            background: rgba(0,0,0,0.8); height: 170px; border-radius: 30px;
            position: relative; border: 3px solid #1e293b; margin-bottom: 25px;
            display: flex; align-items: center; overflow: hidden;
        }

        /* –ö—Ä–∞—Å–Ω—ã–µ –ø–∞–ª–æ—á–∫–∏ (–ø–æ–º–µ—Ö–∏) */
        .interference {
            position: absolute; width: 100%; height: 100%;
            background-image: repeating-linear-gradient(90deg, transparent, transparent 35px, rgba(255,0,0,0.4) 40px);
            display: none; z-index: 1;
        }
        .unstable .interference { display: block; }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏ */
        @keyframes shake {
            0%, 100% { transform: translateY(0) scaleX(-1); }
            50% { transform: translateY(-8px) scaleX(-1); }
        }
        @keyframes shake-rocket {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        .shaking { animation: shake 0.12s infinite linear; }
        .shaking-rocket { animation: shake-rocket 0.12s infinite linear; }

        .truck-unit { position: absolute; left: 0; font-size: 120px; z-index: 10; transform: scaleX(-1); transition: left 0.1s linear; }
        .rocket-mode { transform: scaleX(1); } /* –†–∞–∫–µ—Ç–∞ –Ω–æ—Å–æ–º –≤–ø–µ—Ä–µ–¥ */

        .road-marks {
            position: absolute; width: 100%; height: 100%;
            background-image: linear-gradient(90deg, rgba(255,255,255,0.05) 4px, transparent 4px);
            background-size: 80px 100%;
        }
        .moving .road-marks { animation: travel 0.2s linear infinite; }
        @keyframes travel { from { background-position: 0; } to { background-position: -80px; } }

        /* HUD */
        .hud-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; width: 100%; margin-bottom: 40px; }
        .hud-box { background: #000; border: 3px solid #1e293b; padding: 25px; border-radius: 25px; text-align: center; }
        .hud-val { display: block; font-size: 3.5rem; font-family: 'Orbitron'; color: var(--neon-green); }

        /* –û—Ç—á–µ—Ç –∏ –ò—Å—Ç–æ—Ä–∏—è */
        .bottom-section { display: grid; grid-template-columns: 1fr 400px; gap: 30px; width: 100%; }
        .panel-box { background: rgba(15, 23, 42, 0.8); border: 2px solid #334155; border-radius: 30px; padding: 30px; }
        table { width: 100%; border-collapse: collapse; font-size: 1.4rem; margin-top: 20px; }
        th, td { border: 1px solid #334155; padding: 15px; text-align: center; }
        .history-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #334155; font-size: 1.2rem; }
    </style>
</head>
<body>

<div class="main-ui">
    <header><h1>–ë–ò–¢–í–ê –î–ê–ù–ù–´–•</h1></header>

    <div class="edu-grid">
        <div class="edu-card">
            <h3>üåê –¢–ò–ü –°–ï–¢–ò</h3>
            <p>–≠—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∫–∞–Ω–∞–ª–∞. –ß–µ–º –º–æ—â–Ω–µ–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è (–æ—Ç 3G –¥–æ –û–ø—Ç–∏–∫–∏), —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –ø–∞–∫–µ—Ç—ã –¥–∞–Ω–Ω—ã—Ö.</p>
        </div>
        <div class="edu-card">
            <h3>üì° –°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–¨</h3>
            <p>–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø–æ–º–µ—Ö. –ü—Ä–∏ –Ω–∏–∑–∫–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è, –≤—ã–∑—ã–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ "—Ç—Ä—è—Å–∫—É" –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ.</p>
        </div>
    </div>

    <div class="cockpit">
        <div class="control-slot">
            <label>–û–ë–™–ï–ú –î–ê–ù–ù–´–•</label>
            <select id="cargo">
                <option value="50">–§–û–¢–û (50 –ú–ë)</option>
                <option value="500">–§–ò–õ–¨–ú (500 –ú–ë)</option>
                <option value="2000">–ò–ì–†–ê (2 –ì–ë)</option>
                <option value="10000">–ê–†–•–ò–í (10 –ì–ë)</option>
            </select>
        </div>
        <div class="control-slot">
            <label>–¢–ò–ü –°–ï–¢–ò</label>
            <select id="speed">
                <option value="10">üöú 3G (10 –ú–ë/—Å)</option>
                <option value="100" selected>üöö 4G (100 –ú–ë/—Å)</option>
                <option value="600">üèéÔ∏è 5G (600 –ú–ë/—Å)</option>
                <option value="2500">üöÄ –û–ü–¢–ò–ö–ê (2.5 –ì–ë/—Å)</option>
            </select>
        </div>
        <div class="control-slot">
            <label>–°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–¨</label>
            <select id="quality">
                <option value="1">–ò–î–ï–ê–õ–¨–ù–ê–Ø (100%)</option>
                <option value="0.5">–ü–û–ú–ï–•–ò (50%)</option>
                <option value="0.1">–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø (10%)</option>
            </select>
        </div>
        <button class="btn-launch" onclick="startTest(false)">–¢–ï–°–¢</button>
        <button class="btn-launch" style="background: var(--neon-pink); color: white;" onclick="startTest(true)">–ì–û–ù–ö–ê</button>
    </div>

    <div id="track-zone" class="track-zone"></div>

    <div class="hud-grid">
        <div class="hud-box"><span class="hud-val" id="hud-v">0</span><span style="color:#94a3b8">–ú–ë / –°–ï–ö</span></div>
        <div class="hud-box"><span class="hud-val" id="hud-t" style="color:var(--neon-blue)">0.0</span><span style="color:#94a3b8">–í–†–ï–ú–Ø (–°–ï–ö)</span></div>
        <div class="hud-box"><span class="hud-val" id="hud-p" style="color:var(--neon-pink)">0%</span><span style="color:#94a3b8">–ü–†–û–ì–†–ï–°–°</span></div>
    </div>

    <div class="bottom-section">
        <div class="panel-box" id="analysis-report" style="display:none;">
            <h3 style="font-family:'Orbitron'; color:var(--neon-pink)">üìä –°–†–ê–í–ù–ï–ù–ò–ï –°–ö–û–†–û–°–¢–ï–ô</h3>
            <table id="report-table">
                <thead><tr><th>–°–µ—Ç—å</th><th>–í—Ä–µ–º—è</th><th>–ú–ë/—Å</th><th>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="panel-box">
            <h3 style="font-family:'Orbitron'; color:var(--neon-pink)">üìú –ò–°–¢–û–†–ò–Ø –ó–ê–ü–£–°–ö–û–í</h3>
            <div id="history-list"></div>
        </div>
    </div>
</div>

<script>
    const zone = document.getElementById('track-zone');
    const report = document.getElementById('analysis-report');
    const historyList = document.getElementById('history-list');
    const icons = { '10': 'üöú', '100': 'üöö', '600': 'üèéÔ∏è', '2500': 'üöÄ' };
    let timers = [];
    let raceResults = [];
    let historyData = [];

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSfx() {
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.connect(g); g.connect(audioCtx.destination);
        osc.frequency.setValueAtTime(440, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
        g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
    }

    function startTest(isRace) {
        timers.forEach(clearInterval);
        zone.innerHTML = '';
        report.style.display = 'none';
        raceResults = [];
        
        const cargo = parseFloat(document.getElementById('cargo').value);
        const quality = parseFloat(document.getElementById('quality').value);

        if (isRace) {
            const opts = document.getElementById('speed').options;
            for(let i=0; i<opts.length; i++) {
                createTrack(i, opts[i].text, parseFloat(opts[i].value), cargo, quality, false, opts.length);
            }
        } else {
            const s = document.getElementById('speed');
            createTrack(0, s.options[s.selectedIndex].text, parseFloat(s.value), cargo, quality, true, 1);
        }
    }

    function createTrack(id, name, speed, cargo, quality, updateHud, totalTracks) {
        const lane = document.createElement('div');
        lane.className = 'lane';
        if (quality <= 0.1) lane.classList.add('unstable');
        
        const isRocket = speed === 2500;
        const iconClass = isRocket ? 'truck-unit rocket-mode' : 'truck-unit';

        lane.innerHTML = `
            <div style="position:absolute; top:10px; left:25px; font-size:1.5rem; color:var(--neon-blue); z-index:5; font-weight:bold; font-family:'Orbitron'">${name}</div>
            <div class="road-marks"></div>
            <div class="interference"></div>
            <div class="${iconClass}" id="truck-${id}">${icons[speed]}</div>
        `;
        zone.appendChild(lane);
        
        const truck = document.getElementById(`truck-${id}`);
        if (quality <= 0.1) truck.classList.add(isRocket ? 'shaking-rocket' : 'shaking');
        lane.classList.add('moving');
        
        let delivered = 0;
        const start = Date.now();
        const vReal = speed * quality;

        const t = setInterval(() => {
            delivered += vReal / 10;
            let p = Math.min((delivered / cargo) * 100, 100);
            truck.style.left = `calc(${p}% - 140px)`;

            if (updateHud) {
                document.getElementById('hud-v').innerText = Math.round(vReal * (0.9 + Math.random()*0.2));
                document.getElementById('hud-t').innerText = ((Date.now()-start)/1000).toFixed(1);
                document.getElementById('hud-p').innerText = Math.round(p) + '%';
            }

            if (p >= 100) {
                clearInterval(t);
                playSfx();
                // –û–°–¢–ê–ù–û–í–ö–ê –¢–†–Ø–°–ö–ò
                truck.classList.remove('shaking', 'shaking-rocket');
                lane.classList.remove('moving');
                lane.style.borderColor = 'var(--neon-green)';
                
                const timeTaken = ((Date.now()-start)/1000).toFixed(2);
                raceResults.push({ name, time: parseFloat(timeTaken), speed: vReal });
                
                if (totalTracks === 1) addHistory(name, timeTaken + " —Å–µ–∫");
                if (raceResults.length === totalTracks && totalTracks > 1) showReport();
            }
        }, 100);
        timers.push(t);
    }

    function showReport() {
        report.style.display = 'block';
        const tbody = document.querySelector('#report-table tbody');
        tbody.innerHTML = '';
        raceResults.sort((a,b) => a.time - b.time);
        const win = raceResults[0];

        raceResults.forEach(res => {
            const diff = (res.time / win.time).toFixed(1);
            const status = res.time === win.time ? "üèÜ –ü–û–ë–ï–î–ò–¢–ï–õ–¨" : `–ú–µ–¥–ª–µ–Ω–Ω–µ–µ –≤ ${diff} —Ä–∞–∑`;
            tbody.innerHTML += `<tr><td>${res.name}</td><td>${res.time}—Å</td><td>${Math.round(res.speed)}</td><td>${status}</td></tr>`;
        });
        addHistory("–ì–æ–Ω–∫–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π", win.time + "—Å (–ü–æ–±–µ–¥–∞)");
    }

    function addHistory(type, res) {
        historyData.unshift({ type, res, time: new Date().toLocaleTimeString() });
        if (historyData.length > 5) historyData.pop();
        historyList.innerHTML = historyData.map(h => `
            <div class="history-item">
                <small>${h.time}</small> <strong>${h.type}</strong> <span style="color:var(--neon-green)">${h.res}</span>
            </div>
        `).join('');
    }
</script>

</body>
</html>
